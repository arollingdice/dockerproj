{"changed":false,"filter":false,"title":"list-buckets.py","tooltip":"/list-buckets.py","value":"import boto3\nimport json\nimport sys\nfrom Widgets.widget import widget\nfrom Requests.request import request\nimport time\nimport logging\n\n# upload to s3 bucket\ndef write_to_s3(client, serialize_object, to_bucket, key):\n    s3 = boto3.client('s3')\n    \n\n    s3.put_object(Body=serialize_object, Bucket= to_bucket, \n    Key= f'widgets/{key}')\n    logging.warning(f'added object {key} to S3 bucket')\n    \n\n\n# upload to Dynamo table\ndef put_item_in_database(widget):\n    db = boto3.resource('dynamodb')\n    table = db.Table(\"my_widgets\")\n    serialze = widget.toJSON()\n    widget_json = json.loads(serialze)\n    \n    # store 'otherAttributes' in a variable \n    expand = widget_json['otherAttributes']\n    # delete the 'otherAttributes' key regardless \n    # of whether it is in the dictionary\n    \n    widget_json.pop('otherAttributes', None)\n    for i in expand:\n        for k, v in i.items():\n            widget_json['k'] = v\n    \n    table.put_item(Item=widget_json)\n    logging.warning(f'added object {widget_json[\"widgetId\"]} to dynamo table')\n        \n    \n\nsession = boto3.Session()\n\ns3_client = session.client('s3')\n\n\n        \nbucket_name = 'usu-cs5260-yucong-requests'\nresponse = s3_client.list_objects_v2(Bucket=bucket_name)\nrequests = response.get(\"Contents\")\n\n# storage_method = input('Where do you want to store these widgets:\\n A: S3\\n B: DynamoDB\\n')\n# parse the object to JSON\n\nwhile len(requests):\n    request = requests[0]\n    object_key = request['Key']\n    response = s3_client.get_object(Bucket=bucket_name, Key=object_key)\n    object_json = json.loads(response['Body'].read().decode('utf-8'))\n   \n    oj = object_json\n    \n    op = oj['type']\n    target_bucket = \"usu-cs5260-yucong-web\"\n    # process CREATE operation\n    if op == 'create':\n       \n       \n        # parse JSON object to an Widget object.\n        new_widget = widget(oj['type'], oj['requestId'], oj['widgetId'], \n        oj['owner'], oj['label'], oj['description'],oj['otherAttributes'])\n        \n        # write new Widget object to target bucket.\n        if sys.argv[1] == 's3':\n            write_to_s3(s3_client, new_widget.toJSON(), target_bucket, f\"{new_widget.owner}/{new_widget.widgetId}\")\n        elif sys.argv[1] == 'Dynamo':\n            put_item_in_database(new_widget)\n    \n    requests.remove(request)\n    # if we run out of requests\n    while not requests:\n        time.sleep(3)\n        bucket_name = 'usu-cs5260-yucong-requests'\n        response = s3_client.list_objects_v2(Bucket=bucket_name)\n        requests = response.get(\"Contents\")\n    # To do: process DELETE and CHANGE OPREATION","undoManager":{"mark":-1,"position":-1,"stack":[]},"ace":{"folds":[],"scrolltop":540,"scrollleft":0,"selection":{"start":{"row":11,"column":4},"end":{"row":11,"column":4},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":{"row":37,"state":"start","mode":"ace/mode/python"}},"timestamp":1666826454391}